{% extends "base.html" %}

{% block title %}Home - Grocery Store Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-store me-2"></i>Welcome to Grocery Store Management
        </h1>
    </div>
</div>

<!-- Navigation Cards -->
<div class="row g-4 mb-5">
    <div class="col-md-4 col-lg-2">
        <a href="/dashboard" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-2x text-primary mb-3"></i>
                    <h5 class="card-title">Dashboard</h5>
                    <p class="card-text small text-muted">View reports & analytics</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4 col-lg-2">
        <a href="/inventory" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-boxes fa-2x text-success mb-3"></i>
                    <h5 class="card-title">Inventory</h5>
                    <p class="card-text small text-muted">Manage products & stock</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4 col-lg-2">
        <a href="/billing" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-cash-register fa-2x text-warning mb-3"></i>
                    <h5 class="card-title">Billing</h5>
                    <p class="card-text small text-muted">POS & generate invoice</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4 col-lg-2">
        <a href="/customers" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x text-info mb-3"></i>
                    <h5 class="card-title">Customers</h5>
                    <p class="card-text small text-muted">Manage customer data</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4 col-lg-2">
        <a href="/transactions" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-receipt fa-2x text-secondary mb-3"></i>
                    <h5 class="card-title">Transactions</h5>
                    <p class="card-text small text-muted">View transaction history</p>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-4 col-lg-2">
        <a href="/reports" class="text-decoration-none">
            <div class="card dashboard-card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chart-bar fa-2x text-danger mb-3"></i>
                    <h5 class="card-title">Reports</h5>
                    <p class="card-text small text-muted">Sales analytics</p>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Summary Widgets -->
<div class="row g-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Today's Sales</h6>
                        <h2 class="mb-0" id="todaySales">₹0</h2>
                    </div>
                    <i class="fas fa-rupee-sign fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Transactions Today</h6>
                        <h2 class="mb-0" id="todayTransactions">0</h2>
                    </div>
                    <i class="fas fa-shopping-cart fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Total Products</h6>
                        <h2 class="mb-0" id="totalProducts">0</h2>
                    </div>
                    <i class="fas fa-box fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Low Stock Alerts</h6>
                        <h2 class="mb-0" id="lowStockCount">0</h2>
                    </div>
                    <i class="fas fa-exclamation-triangle fa-3x opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Low Stock Products -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Low Stock Products</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="lowStockTable">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Current Stock</th>
                                <th>Threshold</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="text-center text-muted">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardStats();
});

async function loadDashboardStats() {
    try {
        const response = await fetch('/api/dashboard/stats');
        const data = await response.json();
        
        document.getElementById('todaySales').textContent = '₹' + data.today_sales.toFixed(2);
        document.getElementById('todayTransactions').textContent = data.today_transactions;
        document.getElementById('totalProducts').textContent = data.total_products;
        document.getElementById('lowStockCount').textContent = data.low_stock_count;
        
        // Populate low stock table
        const tbody = document.querySelector('#lowStockTable tbody');
        if (data.low_stock_products && data.low_stock_products.length > 0) {
            tbody.innerHTML = data.low_stock_products.map(product => `
                <tr>
                    <td>${product.product_name}</td>
                    <td><span class="badge bg-danger">${product.quantity}</span></td>
                    <td>${product.low_stock_threshold}</td>
                    <td><span class="badge bg-warning">Low Stock</span></td>
                </tr>
            `).join('');
        } else {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center text-success">No low stock products</td></tr>';
        }
    } catch (error) {
        console.error('Error loading dashboard stats:', error);
    }
}
</script>
{% endblock %}
